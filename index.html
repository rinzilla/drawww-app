<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="telegram-web-app-bot-integration" content="true">
    <title>Telegram Рисовалка</title>
    <style>
        body { margin: 0; padding: 0; }
        canvas { 
            display: block; 
            background: white;
            touch-action: none;
            width: 100vw;
            height: calc(100vh - 60px);
        }
        .controls {
            padding: 10px;
            background: #f5f5f5;
            display: flex;
            justify-content: space-between;
        }
        button {
            padding: 8px 15px;
            background: #0088cc;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <canvas id="drawingCanvas"></canvas>
    <div class="controls">
        <button id="clearBtn">Очистить</button>
        <button id="saveBtn">Сохранить в чат</button>
    </div>

    <script>
        const canvas = document.getElementById('drawingCanvas');
        const ctx = canvas.getContext('2d');
        let isDrawing = false;
        
        // Настройка холста
        function resizeCanvas() {
            const size = Math.min(window.innerWidth, window.innerHeight) * 0.9;
            canvas.width = size;
            canvas.height = size;
            redraw();
        }
        
        function redraw() {
            // Очищаем и перерисовываем (можно добавить сохранение состояния)
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }
        
        // Инициализация Telegram WebApp
        function initTelegram() {
            if (window.Telegram && Telegram.WebApp) {
                Telegram.WebApp.ready();
                Telegram.WebApp.expand();
                Telegram.WebApp.setHeaderColor("#0088cc");
                Telegram.WebApp.setBackgroundColor("#ffffff");
                return true;
            }
            return false;
        }
        
        // Рисование
        function setupDrawing() {
            canvas.addEventListener('pointerdown', startDrawing);
            canvas.addEventListener('pointermove', draw);
            canvas.addEventListener('pointerup', stopDrawing);
            canvas.addEventListener('pointerout', stopDrawing);
            
            function startDrawing(e) {
                isDrawing = true;
                ctx.beginPath();
                const rect = canvas.getBoundingClientRect();
                ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
                ctx.lineWidth = 5;
                ctx.strokeStyle = '#000000';
                ctx.lineCap = 'round';
            }
            
            function draw(e) {
                if (!isDrawing) return;
                const rect = canvas.getBoundingClientRect();
                ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
                ctx.stroke();
            }
            
            function stopDrawing() {
                isDrawing = false;
            }
        }
        
        // Управление
        function setupControls() {
            document.getElementById('clearBtn').addEventListener('click', () => {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            });
            
            document.getElementById('saveBtn').addEventListener('click', () => {
                const dataURL = canvas.toDataURL('image/png');
                
                if (initTelegram()) {
                    Telegram.WebApp.sendData(dataURL);
                    Telegram.WebApp.close();
                } else {
                    alert("Пожалуйста, используйте мини-приложение в Telegram");
                }
            });
        }
        
        // Инициализация
        function init() {
            resizeCanvas();
            setupDrawing();
            setupControls();
            window.addEventListener('resize', resizeCanvas);
            
            if (!initTelegram()) {
                document.body.style.backgroundColor = "#f0f0f0";
                alert("Для лучшего опыта откройте в Telegram");
            }
        }
        
        init();
    </script>
</body>
</html>
